/*! script 06-01-2016 */
String.prototype.linkify=function(){var a,b,c;b=/(\b(https?|ftp):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/gim;c=/(^|[^\/])(www\.[\S]+(\b|$))/gim;a=this.replace(b,'<a href="$1" target="_blank">$1</a>');a=a.replace(c,'$1<a href="http://$2" target="_blank">$2</a>');return a};String.prototype.replaceBetween=function(a,b,c){return this.substring(0,a)+c+this.substring(b+1)};String.prototype.capitalize=function(){return this.charAt(0).toUpperCase()+this.slice(1)};Array.prototype.contains=function(a){var b=this.length;while(b--){if(this[b]===a)return true}return false};var Templating=function(){};Templating.prototype.userTemplating=function(a){var b='<span class="time">{DATE}</span>'+"{USER_BADGES_ICONS}"+'<span class="user-name" data-sender="{SENDER}" style="color: {USER_COLOR}">{USER_NAME}:</span>';if(a.user===undefined)return"";b=b.replace("{USER_COLOR}",a.user.color);b=b.replace("{USER_NAME}",a.user.display_name);b=b.replace("{DATE}",a.time);b=b.replace("{USER_BADGES_ICONS}",a.user.badges);b=b.replace("{SENDER}",a.user.user_name);return b};Templating.prototype.messageTemplating=function(a){var b='<div class="chat-line">'+this.userTemplating(a)+'<span class="message" style="color: {MESSAGE_COLOR}">{MESSAGE}</span>'+"</div>";b=b.replace("{MESSAGE}",a.processed_message);b=b.replace("{MESSAGE_COLOR}",a.color);return b};Templating.prototype.emoticonTemplating=function(a){var b='<span class="emoticon" style="'+"background-image: url(//static-cdn.jtvnw.net/emoticons/v1/{ID}/1.0); "+"height: 24px; "+"width: 24px; "+'margin: -5px 0px;">'+"</span>";return b.replace("{ID}",a)};Templating.prototype.subscriberTemplating=function(a){var b='<span class="badge" style="'+'background-image: url({BACKGROUND_IMAGE});">'+"</span>";b=b.replace("{BACKGROUND_IMAGE}",a);return b};Templating.prototype.badgeTemplating=function(a){var b='<span class="badge {BADGE}"></span>';b=b.replace("{BADGE}",a);return b};var EmoticonHandler=function(){this.badges=[];this.templating=new Templating;this.initializeEmoticons()};EmoticonHandler.prototype.prepareReplaces=function(a,b){var c=a.split(":"),d=parseInt(c[0]),e=c[1].split(",");for(var f=0;f<e.length;f++){var g=e[f].split("-"),h=parseInt(g[0]),i=parseInt(g[1]);b.push([h,i,d])}return b};EmoticonHandler.prototype.replaceEmoticons=function(a){if(!a.emotes)return a.message;var b=a.emotes.split("/"),c=a.message,d=[];for(var e=0;e<b.length;e++){d=this.prepareReplaces(b[e],d)}d.sort(function(a,b){return b[0]-a[0]});for(var e=0;e<d.length;e++){var f=d[e],g=this.templating.emoticonTemplating(f[2]);c=c.replaceBetween(f[0],f[1],g)}return c};EmoticonHandler.prototype.getUserBadges=function(a){var b="";for(var c=0;c<a.modes.length;c++){var d=a.modes[c];if(d in this.badges)b+=this.badges[d]}return b};EmoticonHandler.prototype.setBadges=function(a){var b=this;$.each(a,function(a,c){if(a=="subscriber"&&c!==null)b.badges[a]=b.templating.subscriberTemplating(c.image);else b.badges[a]=b.templating.badgeTemplating(a)})};EmoticonHandler.prototype.initializeEmoticons=function(){var a=this;$.ajax({url:"https://api.twitch.tv/kraken/chat/"+channelName.substring(1)+"/badges",dataType:"jsonp"}).done(function(b){delete b["_links"];a.setBadges(b)})};var ChatHandler=function(a,b){this.messageCount=1;this.chatBox=a;this.chatInput=b;this.maxChatMessages=150};ChatHandler.prototype.isScrolledToBottom=function(){return this.chatBox[0].scrollHeight-this.chatBox.scrollTop()-15<=this.chatBox.outerHeight()};ChatHandler.prototype.scrollDown=function(){this.chatBox.scrollTop(this.chatBox[0].scrollHeight)};ChatHandler.prototype.deleteFirstMessages=function(){while(this.messageCount>this.maxChatMessages){--this.messageCount;this.chatBox.find(".chat-line").first().remove()}};ChatHandler.prototype.addChatLine=function(a){var b=this.isScrolledToBottom();++this.messageCount;this.chatBox.append(a);if(b){this.deleteFirstMessages();this.scrollDown()}};ChatHandler.prototype.removeAllChatLines=function(){this.chatBox.find("div").remove()};ChatHandler.prototype.removeChatLinesFrom=function(a){var b=this.chatBox.find('span[data-sender="'+a+'"]');b.each(function(){$(this).parent().removeClass().addClass("chat-line").addClass("grey");$(this).parent().find("span.message").text("<message deleted>")})};ChatHandler.prototype.clearChatInput=function(){this.chatInput.val("")};ChatHandler.prototype.trackEvent=function(a,b,c){if(typeof ga!=="undefined"){ga("send","event",a,b,c)}};var TwitchChat=function(){this.socket=io.connect(baseUrl);this.templating=new Templating;this.chatHandler=new ChatHandler($(".chat-lines"),$(".chat-input"));this.emoticonHandler=new EmoticonHandler;this.userName=""};TwitchChat.prototype.getChatLine=function(a){a.processed_message=this.emoticonHandler.replaceEmoticons(a);a.time=moment(a.time).format("HH:mm");if(a.user){a.user.badges=this.emoticonHandler.getUserBadges(a.user)}return this.templating.messageTemplating(a)};TwitchChat.prototype.addMessage=function(a){var b=this.getChatLine(a);this.chatHandler.addChatLine(b)};TwitchChat.prototype.deleteAllMessages=function(){this.chatHandler.removeAllChatLines()};TwitchChat.prototype.deleteMessages=function(a){this.chatHandler.removeChatLinesFrom(a)};TwitchChat.prototype.sendMessage=function(a,b){if(a!=""){this.socket.emit("message_to_send",a);this.chatHandler.clearChatInput();this.chatHandler.trackEvent("Sending Messages",b,this.userName)}};TwitchChat.prototype.sendCredentials=function(a,b){this.userName=a;this.chatHandler.trackEvent("Twitch Login","Succesful Login",this.userName);this.socket.json.emit("login",{username:a,oauth:"oauth:"+b})};var twitchChat=new TwitchChat;Twitch.init({clientId:clientId},function(a,b){if(a)console.log(a);if(b.authenticated){var c=Twitch.getToken();Twitch.api({method:"user"},function(a,b){if(a)console.log(a);twitchChat.sendCredentials(b.name,c)});$(".chat-input").attr("placeholder","Chat about this Channel")}else{$(".chat-input").attr("placeholder","Sign up or log in to chat");$(".chat-input").attr("disabled","disabled");$(".twitch-connect").show();$(".twitch-connect").click(function(){twitchChat.chatHandler.trackEvent("Twitch Login","Button");Twitch.login({redirect_uri:baseUrl,popup:false,scope:["user_read","chat_login"]})})}});$(document).ready(function(){$(".chat-input").keypress(function(a){if(a.which==13){twitchChat.sendMessage($(".chat-input").val(),"Keyboard");a.preventDefault()}});$(".send-chat-message").click(function(){twitchChat.sendMessage($(".chat-input").val(),"Button")});twitchChat.socket.on("message",function(a){twitchChat.addMessage(a)});twitchChat.socket.on("clear_chat",function(a){twitchChat.deleteMessages(a)});twitchChat.socket.on("clear_all_chat",function(){twitchChat.deleteAllMessages()})});